<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test editorjs 360 media</title>
        <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@2.27.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/@editorjs/image"></script>

        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.155.0/three.min.js"></script> -->
        <script src="./dist/dev-build.js" onerror="document.head.appendChild(`<script src='./dist/bundle.js'></script>`)"></script>
        <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

        <link rel="stylesheet" href="index.css" />
    </head>
    <body>
        <div id="editor" style="background-color: antiquewhite"></div>
        <button id="toggleReadOnly">Toggle readOnly</button>

        <script>
            const Editorjs3DMedia = self.Editorjs3DMedia
            const dataLocation = 'editorjs-data-testing'

            let data = {}
            try {
                data = JSON.parse(localStorage.getItem(dataLocation))
            } catch {}
            var editor = new EditorJS({
                holder: 'editor',
                tools: {
                    media3d: {
                        class: Editorjs3DMedia,
                        config: {
                            uploadFile(file) {
                                // Your file uploading logic here
                                const fileUrl = URL.createObjectURL(file)
                                window.addEventListener(
                                    'beforeunload',
                                    () => {
                                        URL.revokeObjectURL(fileUrl)
                                    },
                                    { once: true },
                                )
                                return new Promise((resolve) => {
                                    setTimeout(() => {
                                        resolve({
                                            url: fileUrl,
                                        })
                                    }, 2000)
                                })
                            },
                        },
                    },
                    simpleImage: {
                        class: self.ImageTool,
                        config: {
                            endpoints: {
                                byFile: 'http://127.0.0.1:8000/uploadFile', // Your backend file uploader endpoint
                                byUrl: 'http://127.0.0.1:8000/fetchUrl', // Your endpoint that provides uploading by Url
                            },
                        },
                    },
                },
                // readOnly: true,
                onChange(api) {
                    api.saver.save().then((data) => {
                        // remove media3d blocks
                        data.blocks = data.blocks.filter((block) => block.type !== 'media3d')
                        localStorage.setItem(dataLocation, JSON.stringify(data))
                    })
                },
                data,
                i18n: {
                    messages: {
                        tools: {
                            media: {
                                Caption: 'Captiune',
                            },
                        },
                    },
                },
            })
            document.getElementById('toggleReadOnly').addEventListener('click', () => {
                editor.readOnly.toggle()
            })
        </script>
        <footer>
            <p style="text-align: center; margin-top: 2em; color: gray">
                Files are temporarily saved in browser memory. They will be lost when you refresh the page.
            </p>
            <p style="text-align: center; margin-top: 2em; color: gray">
                You can find free example files to test the 3D media block at
                <a href="https://github.khronos.org/glTF-Sample-Viewer-Release/" target="_blank">glTF-Sample-Viewer-Release</a>
            </p>
        </footer>
    </body>
</html>
